name: json
description: create a deployment and check the json condition succeeds

defaults:
  kube:
    namespace: json

tests:
  - name: create-deployment
    kube:
      create: testdata/manifests/nginx-deployment.yaml

  - name: deployment-json-assertions
    timeout:
      after: 20s
    kube:
      get: deployments/nginx
    assert:
      json:
        paths:
          $.spec.replicas: 2
          $.spec.template.metadata.labels["app"]: nginx
          $.status.readyReplicas: 2
        path_formats:
          $.metadata.uid: uuid4
          $.metadata.creationTimestamp: date-time

  - name: deployment-json-assertions-list
    timeout:
      after: 20s
    kube:
      get:
        type: deployments
        labels:
          app: nginx
    assert:
      len: 1
      json:
        paths:
          $[0].spec.replicas: 2

  - name: delete-deployment
    kube:
      delete: deployments/nginx
